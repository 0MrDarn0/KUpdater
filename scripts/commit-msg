#!/bin/sh

# commit-msg hook: validate commit message format
COMMIT_MSG_FILE=$1
COMMIT_MSG=$(head -n1 "$COMMIT_MSG_FILE")

# Allowed types (case-insensitive)
VALID_TYPES="add|fix|refactor|change|remove|docs|test|style|chore|feat|breaking"

# Regex: type optionally followed by (scope), then colon and space
if ! echo "$COMMIT_MSG" | grep -Eiq "^(${VALID_TYPES})(\([a-z0-9_-]+\))?: "; then
  echo "❌ Invalid commit message!"
  echo "➡️  Please start with one of the allowed types, optionally with a scope, followed by ': '"
  echo "   Allowed types: Add, Fix, Refactor, Change, Remove, Docs, Test, Style, Chore, Feat, Breaking"
  echo "✅ Examples:"
  echo "   Fix: correct layout"
  echo "   Fix(ui): correct layout"
  echo "   Add(pipeline): introduce auto-discovery"
  exit 1
fi
